{{ define "body" }}
{{ template "post_meta" (dict "post" .post "can_upvote" (.post.CanUpvote .current_user) "can_delete" (.post.CanDelete .current_user) "authorized" .authorized)}}
<br/>
<table>
  <tbody>
    <tr>
      <td>&nbsp;&nbsp;</td>
      <td>
        <form action="/post/{{ .post.ID }}/submit" method="POST">
          <textarea cols="50" rows="7" name="content">{{ .content }}</textarea>
          <div class="error">
            {{ with .errors.content }}
              <span> ({{ . }})</span>
            {{ end }}
          </div>
          <br/>
          <input type="submit" value="reply" />
        </form>
      </td>
    </tr>
  </tbody>
</table>
<br/>
{{ range $comment := .post.Posts }}
  <table>
    <tr>
      <td class="vote">
        {{ if $.authorized }}
          <a {{ if ($comment.CanUpvote $.current_user) }} href="/post/{{ $comment.ID }}/upvote" {{ else }} class="invisible" {{ end }}>â–²</a>
        {{ end }}
      </td>
      <td>
        <span class="small">
          <a href="/user/{{ $comment.User.Name }}">{{ $comment.User.Name }}</a>
          {{ if $.authorized }}
            {{ if ($comment.CanDelete $.current_user) }}
              <span>| </span>
              <a onclick="return confirm('Are you sure you want to delete this post?')" href="/post/{{ $comment.ID }}/delete">delete</a>
            {{ end }}
          {{ end }}
        </span>
      </td>
    </tr>
    <tr>
      <td></td>
      <td class="comment">
        {{ $comment.Content }}
      </td>
    </tr>
    <tr>
      <td></td>
      <td><span class="small"><a href="/post/{{ $comment.ID }}/submit">reply</a></span></td>
    </tr>
  </table>
{{ end }}

{{ end }}
